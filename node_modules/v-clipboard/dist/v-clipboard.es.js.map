{"version":3,"file":"v-clipboard.es.js","sources":["../src/cache.ts","../src/convert.ts","../src/textarea.ts","../src/clipboard.ts","../src/plugin.ts"],"sourcesContent":["export class Cache {\n  private seed = 0\n  private data: Map<string, Function> = new Map()\n\n  private id() {\n    return Date.now().toString(26) + this.seed++\n  }\n\n  add(value: Function, id: string = this.id()) {\n    this.data.set(id, value)\n\n    return id\n  }\n\n  get(id: string) {\n    return this.data.get(id)\n  }\n\n  delete(id: string) {\n    this.delete(id)\n  }\n}\n","const message = 'Failed to copy value to clipboard. Unknown type.'\n\nexport const Convert = {\n  asString(value: any): string {\n    if (value == null) {\n      console.warn('Clipboard input is empty')\n      return ''\n    }\n\n    if (typeof value !== 'string') {\n      try {\n        return JSON.stringify(value)\n      } catch (error) {\n        console.warn(message, error)\n\n        return ''\n      }\n    }\n\n    return value\n  }\n}\n","const cssText = 'position:fixed; pointer-events:none; z-index:-9999; opacity:0;'\n\nexport const Textarea = {\n  createTextarea(value: string) {\n    const textarea = document.createElement('textarea')\n\n    textarea.addEventListener('focusin', (event) => {\n      event.stopPropagation()\n    })\n\n    textarea.value = value\n    textarea.setAttribute('readonly', '')\n    textarea.style.cssText = cssText\n\n    return textarea\n  }\n}\n","import { Convert } from './convert'\nimport { Textarea } from './textarea'\n\nexport const Clipboard = {\n  /**\n   * Requests Navigator API persmission to clipboard.\n   */\n  async requestClipboardPermission() {\n    return navigator.permissions.query({\n      name: 'clipboard-write' as PermissionName\n    })\n  },\n  /**\n   * Writes to cliboard using Navigator API.\n   */\n  async writeClipboard(value: string) {\n    const permissions = await Clipboard.requestClipboardPermission()\n\n    if (permissions.state === 'granted') {\n      await navigator.clipboard.writeText(value)\n      return true\n    }\n\n    return false\n  },\n  /**\n   * Writes to clipboard using old-school execCommand('copy').\n   */\n  writeClipboardExecCommand(value: string) {\n    const textarea = Textarea.createTextarea(value)\n\n    document.body.appendChild(textarea)\n\n    if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {\n      textarea.contentEditable = 'true'\n      textarea.readOnly = true\n\n      const range = document.createRange()\n\n      range.selectNodeContents(textarea)\n\n      const selection = window.getSelection()\n\n      if (selection) {\n        selection.removeAllRanges()\n        selection.addRange(range)\n        textarea.setSelectionRange(0, 999999)\n      }\n    } else {\n      textarea.select()\n    }\n\n    const result = document.execCommand('copy')\n    document.body.removeChild(textarea)\n\n    return result\n  },\n  /**\n   * Maes an attempt to copy data to the clipboard.\n   */\n  async copy(input: any) {\n    const data = typeof input === 'function' ? input() : input\n    const value = Convert.asString(data)\n\n    const copied = Clipboard.writeClipboardExecCommand(value)\n\n    if (copied) {\n      return true\n    }\n\n    await Clipboard.writeClipboard(value)\n  }\n}\n","import { Directive, Plugin } from 'vue'\nimport { Cache } from './cache'\nimport { Clipboard } from './clipboard'\n\ntype ClipboardDirective = Function | string | object | null | undefined\n\nconst cache = new Cache()\n\nexport const ClipboardPlugin: Plugin = {\n  install(app) {\n    const context =\n      // @ts-ignore\n      app.version[0] === '3' ? app.config.globalProperties : app.prototype\n\n    context.$clipboard = Clipboard.copy\n\n    app.directive('clipboard', <Directive<HTMLElement, ClipboardDirective>>{\n      beforeMount(el, binding) {\n        const arg = binding.arg\n        const value = binding.value\n        const isFn = typeof value === 'function'\n\n        if (arg === 'error' && isFn) {\n          el.dataset.clipboardError = cache.add(value)\n          return\n        }\n\n        if (arg === 'error' && isFn) {\n          el.dataset.clipboardSuccess = cache.add(value)\n          return\n        }\n\n        const onClick = async (event: MouseEvent) => {\n          const success = await Clipboard.copy(value)\n\n          const callbackId = success\n            ? el.dataset.clipboardSuccess\n            : el.dataset.clipboardError\n\n          cache.get(callbackId!)?.({ value, event })\n        }\n\n        el.dataset.clipboardClick = cache.add(onClick)\n        el.addEventListener('click', onClick)\n      },\n\n      unmounted(el) {\n        const {\n          clipboardSuccessHandler,\n          clipboardErrorHandler,\n          clipboardClickHandler\n        } = el.dataset\n\n        if (clipboardSuccessHandler) {\n          cache.delete(clipboardSuccessHandler)\n        }\n\n        if (clipboardErrorHandler) {\n          cache.delete(clipboardErrorHandler)\n        }\n\n        if (clipboardClickHandler) {\n          const handler = cache.get(clipboardClickHandler)\n\n          if (handler) {\n            el.removeEventListener('click', handler as () => {})\n            cache.delete(clipboardClickHandler)\n          }\n        }\n      },\n      /**\n       * Vue 2 compatability\n       */\n      get bind() {\n        // @ts-ignore\n        return this.beforeMount\n      },\n\n      get unbind() {\n        // @ts-ignore\n        return this.unmounted\n      }\n    })\n  }\n}\n"],"names":["Cache","__publicField","value","id","message","Convert","error","cssText","Textarea","textarea","event","Clipboard","range","selection","result","input","data","cache","ClipboardPlugin","app","context","el","binding","arg","isFn","onClick","_a","callbackId","clipboardSuccessHandler","clipboardErrorHandler","clipboardClickHandler","handler"],"mappings":"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"}