{"version":3,"file":"v-clipboard.umd.js","sources":["../src/cache.ts","../src/convert.ts","../src/textarea.ts","../src/clipboard.ts","../src/plugin.ts"],"sourcesContent":["export class Cache {\n  private seed = 0\n  private data: Map<string, Function> = new Map()\n\n  private id() {\n    return Date.now().toString(26) + this.seed++\n  }\n\n  add(value: Function, id: string = this.id()) {\n    this.data.set(id, value)\n\n    return id\n  }\n\n  get(id: string) {\n    return this.data.get(id)\n  }\n\n  delete(id: string) {\n    this.delete(id)\n  }\n}\n","const message = 'Failed to copy value to clipboard. Unknown type.'\n\nexport const Convert = {\n  asString(value: any): string {\n    if (value == null) {\n      console.warn('Clipboard input is empty')\n      return ''\n    }\n\n    if (typeof value !== 'string') {\n      try {\n        return JSON.stringify(value)\n      } catch (error) {\n        console.warn(message, error)\n\n        return ''\n      }\n    }\n\n    return value\n  }\n}\n","const cssText = 'position:fixed; pointer-events:none; z-index:-9999; opacity:0;'\n\nexport const Textarea = {\n  createTextarea(value: string) {\n    const textarea = document.createElement('textarea')\n\n    textarea.addEventListener('focusin', (event) => {\n      event.stopPropagation()\n    })\n\n    textarea.value = value\n    textarea.setAttribute('readonly', '')\n    textarea.style.cssText = cssText\n\n    return textarea\n  }\n}\n","import { Convert } from './convert'\nimport { Textarea } from './textarea'\n\nexport const Clipboard = {\n  /**\n   * Requests Navigator API persmission to clipboard.\n   */\n  async requestClipboardPermission() {\n    return navigator.permissions.query({\n      name: 'clipboard-write' as PermissionName\n    })\n  },\n  /**\n   * Writes to cliboard using Navigator API.\n   */\n  async writeClipboard(value: string) {\n    const permissions = await Clipboard.requestClipboardPermission()\n\n    if (permissions.state === 'granted') {\n      await navigator.clipboard.writeText(value)\n      return true\n    }\n\n    return false\n  },\n  /**\n   * Writes to clipboard using old-school execCommand('copy').\n   */\n  writeClipboardExecCommand(value: string) {\n    const textarea = Textarea.createTextarea(value)\n\n    document.body.appendChild(textarea)\n\n    if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {\n      textarea.contentEditable = 'true'\n      textarea.readOnly = true\n\n      const range = document.createRange()\n\n      range.selectNodeContents(textarea)\n\n      const selection = window.getSelection()\n\n      if (selection) {\n        selection.removeAllRanges()\n        selection.addRange(range)\n        textarea.setSelectionRange(0, 999999)\n      }\n    } else {\n      textarea.select()\n    }\n\n    const result = document.execCommand('copy')\n    document.body.removeChild(textarea)\n\n    return result\n  },\n  /**\n   * Maes an attempt to copy data to the clipboard.\n   */\n  async copy(input: any) {\n    const data = typeof input === 'function' ? input() : input\n    const value = Convert.asString(data)\n\n    const copied = Clipboard.writeClipboardExecCommand(value)\n\n    if (copied) {\n      return true\n    }\n\n    await Clipboard.writeClipboard(value)\n  }\n}\n","import { Directive, Plugin } from 'vue'\nimport { Cache } from './cache'\nimport { Clipboard } from './clipboard'\n\ntype ClipboardDirective = Function | string | object | null | undefined\n\nconst cache = new Cache()\n\nexport const ClipboardPlugin: Plugin = {\n  install(app) {\n    const context =\n      // @ts-ignore\n      app.version[0] === '3' ? app.config.globalProperties : app.prototype\n\n    context.$clipboard = Clipboard.copy\n\n    app.directive('clipboard', <Directive<HTMLElement, ClipboardDirective>>{\n      beforeMount(el, binding) {\n        const arg = binding.arg\n        const value = binding.value\n        const isFn = typeof value === 'function'\n\n        if (arg === 'error' && isFn) {\n          el.dataset.clipboardError = cache.add(value)\n          return\n        }\n\n        if (arg === 'error' && isFn) {\n          el.dataset.clipboardSuccess = cache.add(value)\n          return\n        }\n\n        const onClick = async (event: MouseEvent) => {\n          const success = await Clipboard.copy(value)\n\n          const callbackId = success\n            ? el.dataset.clipboardSuccess\n            : el.dataset.clipboardError\n\n          cache.get(callbackId!)?.({ value, event })\n        }\n\n        el.dataset.clipboardClick = cache.add(onClick)\n        el.addEventListener('click', onClick)\n      },\n\n      unmounted(el) {\n        const {\n          clipboardSuccessHandler,\n          clipboardErrorHandler,\n          clipboardClickHandler\n        } = el.dataset\n\n        if (clipboardSuccessHandler) {\n          cache.delete(clipboardSuccessHandler)\n        }\n\n        if (clipboardErrorHandler) {\n          cache.delete(clipboardErrorHandler)\n        }\n\n        if (clipboardClickHandler) {\n          const handler = cache.get(clipboardClickHandler)\n\n          if (handler) {\n            el.removeEventListener('click', handler as () => {})\n            cache.delete(clipboardClickHandler)\n          }\n        }\n      },\n      /**\n       * Vue 2 compatability\n       */\n      get bind() {\n        // @ts-ignore\n        return this.beforeMount\n      },\n\n      get unbind() {\n        // @ts-ignore\n        return this.unmounted\n      }\n    })\n  }\n}\n"],"names":["Cache","__publicField","value","id","message","Convert","error","cssText","Textarea","textarea","event","Clipboard","range","selection","result","input","data","cache","ClipboardPlugin","app","context","el","binding","arg","isFn","onClick","callbackId","_a","clipboardSuccessHandler","clipboardErrorHandler","clipboardClickHandler","handler"],"mappings":"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"}